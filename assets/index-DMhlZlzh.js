var dr=Object.defineProperty;var pr=(e,t,n)=>t in e?dr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var C=(e,t,n)=>pr(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const I={context:void 0,registry:void 0,effects:void 0,done:!1,getContextId(){return Qt(this.context.count)},getNextContextId(){return Qt(this.context.count++)}};function Qt(e){const t=String(e),n=t.length-1;return I.context.id+(n?String.fromCharCode(96+n):"")+t}function gr(e){I.context=e}const mr=(e,t)=>e===t,wr=Symbol("solid-proxy"),br=Symbol("solid-track"),je={equals:mr};let wn=yn;const ue=1,He=2,bn={owned:null,cleanups:null,context:null,owner:null};var S=null;let at=null,kr=null,$=null,z=null,ne=null,ot=0;function Le(e,t){const n=$,r=S,i=e.length===0,o=t===void 0?r:t,s=i?bn:{owned:null,cleanups:null,context:o?o.context:null,owner:o},l=i?e:()=>e(()=>V(()=>Me(s)));S=s,$=null;try{return Se(l,!0)}finally{$=n,S=r}}function G(e,t){t=t?Object.assign({},je,t):je;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=i=>(typeof i=="function"&&(i=i(n.value)),vn(n,i));return[kn.bind(n),r]}function ce(e,t,n){const r=It(e,t,!1,ue);ze(r)}function Y(e,t,n){wn=Sr;const r=It(e,t,!1,ue);r.user=!0,ne?ne.push(r):ze(r)}function J(e,t,n){n=n?Object.assign({},je,n):je;const r=It(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,ze(r),kn.bind(r)}function Zt(e){return Se(e,!1)}function V(e){if($===null)return e();const t=$;$=null;try{return e()}finally{$=t}}function Oe(e,t,n){const r=Array.isArray(e);let i;return o=>{let s;if(r){s=Array(e.length);for(let c=0;c<e.length;c++)s[c]=e[c]()}else s=e();const l=V(()=>t(s,i,o));return i=s,l}}function vr(e){Y(()=>V(e))}function yr(e){return S===null||(S.cleanups===null?S.cleanups=[e]:S.cleanups.push(e)),e}function Cr(e,t){const n=Symbol("context");return{id:n,Provider:Er(n),defaultValue:e}}function Dt(e){let t;return S&&S.context&&(t=S.context[e.id])!==void 0?t:e.defaultValue}function _r(e){const t=J(e),n=J(()=>wt(t()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}function kn(){if(this.sources&&this.state)if(this.state===ue)ze(this);else{const e=z;z=null,Se(()=>Ve(this),!1),z=e}if($){const e=this.observers?this.observers.length:0;$.sources?($.sources.push(this),$.sourceSlots.push(e)):($.sources=[this],$.sourceSlots=[e]),this.observers?(this.observers.push($),this.observerSlots.push($.sources.length-1)):(this.observers=[$],this.observerSlots=[$.sources.length-1])}return this.value}function vn(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&Se(()=>{for(let i=0;i<e.observers.length;i+=1){const o=e.observers[i],s=at&&at.running;s&&at.disposed.has(o),(s?!o.tState:!o.state)&&(o.pure?z.push(o):ne.push(o),o.observers&&Cn(o)),s||(o.state=ue)}if(z.length>1e6)throw z=[],new Error},!1)),t}function ze(e){if(!e.fn)return;Me(e);const t=ot;xr(e,e.value,t)}function xr(e,t,n){let r;const i=S,o=$;$=S=e;try{r=e.fn(t)}catch(s){return e.pure&&(e.state=ue,e.owned&&e.owned.forEach(Me),e.owned=null),e.updatedAt=n+1,_n(s)}finally{$=o,S=i}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?vn(e,r):e.value=r,e.updatedAt=n)}function It(e,t,n,r=ue,i){const o={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:S,context:S?S.context:null,pure:n};return S===null||S!==bn&&(S.owned?S.owned.push(o):S.owned=[o]),o}function Ue(e){if(e.state===0)return;if(e.state===He)return Ve(e);if(e.suspense&&V(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<ot);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===ue)ze(e);else if(e.state===He){const r=z;z=null,Se(()=>Ve(e,t[0]),!1),z=r}}function Se(e,t){if(z)return e();let n=!1;t||(z=[]),ne?n=!0:ne=[],ot++;try{const r=e();return Ar(n),r}catch(r){n||(ne=null),z=null,_n(r)}}function Ar(e){if(z&&(yn(z),z=null),e)return;const t=ne;ne=null,t.length&&Se(()=>wn(t),!1)}function yn(e){for(let t=0;t<e.length;t++)Ue(e[t])}function Sr(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:Ue(r)}if(I.context){if(I.count){I.effects||(I.effects=[]),I.effects.push(...e.slice(0,n));return}gr()}for(I.effects&&!I.count&&(e=[...I.effects,...e],n+=I.effects.length,delete I.effects),t=0;t<n;t++)Ue(e[t])}function Ve(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const i=r.state;i===ue?r!==t&&(!r.updatedAt||r.updatedAt<ot)&&Ue(r):i===He&&Ve(r,t)}}}function Cn(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=He,n.pure?z.push(n):ne.push(n),n.observers&&Cn(n))}}function Me(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),i=n.observers;if(i&&i.length){const o=i.pop(),s=n.observerSlots.pop();r<i.length&&(o.sourceSlots[s]=r,i[r]=o,n.observerSlots[r]=s)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Me(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Me(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function Pr(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function _n(e,t=S){throw Pr(e)}function wt(e){if(typeof e=="function"&&!e.length)return wt(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const r=wt(e[n]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return e}function Er(e,t){return function(r){let i;return ce(()=>i=V(()=>(S.context={...S.context,[e]:r.value},_r(()=>r.children))),void 0),i}}const $r=Symbol("fallback");function Xt(e){for(let t=0;t<e.length;t++)e[t]()}function xn(e,t,n={}){let r=[],i=[],o=[],s=0,l=t.length>1?[]:null;return yr(()=>Xt(o)),()=>{let c=e()||[],u=c.length,f,a;return c[br],V(()=>{let g,m,p,w,y,b,A,E,x;if(u===0)s!==0&&(Xt(o),o=[],r=[],i=[],s=0,l&&(l=[])),n.fallback&&(r=[$r],i[0]=Le(q=>(o[0]=q,n.fallback())),s=1);else if(s===0){for(i=new Array(u),a=0;a<u;a++)r[a]=c[a],i[a]=Le(d);s=u}else{for(p=new Array(u),w=new Array(u),l&&(y=new Array(u)),b=0,A=Math.min(s,u);b<A&&r[b]===c[b];b++);for(A=s-1,E=u-1;A>=b&&E>=b&&r[A]===c[E];A--,E--)p[E]=i[A],w[E]=o[A],l&&(y[E]=l[A]);for(g=new Map,m=new Array(E+1),a=E;a>=b;a--)x=c[a],f=g.get(x),m[a]=f===void 0?-1:f,g.set(x,a);for(f=b;f<=A;f++)x=r[f],a=g.get(x),a!==void 0&&a!==-1?(p[a]=i[f],w[a]=o[f],l&&(y[a]=l[f]),a=m[a],g.set(x,a)):o[f]();for(a=b;a<u;a++)a in p?(i[a]=p[a],o[a]=w[a],l&&(l[a]=y[a],l[a](a))):i[a]=Le(d);i=i.slice(0,s=u),r=c.slice(0)}return i});function d(g){if(o[a]=g,l){const[m,p]=G(a);return l[a]=p,t(c[a],m)}return t(c[a])}}}function K(e,t){return V(()=>e(t||{}))}let Or=0;function Mr(){return I.context?I.getNextContextId():`cl-${Or++}`}const Rr=e=>`Stale read from <${e}>.`;function Be(e){const t="fallback"in e&&{fallback:()=>e.fallback};return J(xn(()=>e.each,e.children,t||void 0))}function An(e){const t=e.keyed,n=J(()=>e.when,void 0,{equals:(r,i)=>t?r===i:!r==!i});return J(()=>{const r=n();if(r){const i=e.children;return typeof i=="function"&&i.length>0?V(()=>i(t?r:()=>{if(!V(n))throw Rr("Show");return e.when})):i}return e.fallback},void 0,void 0)}function Nr(e,t,n){let r=n.length,i=t.length,o=r,s=0,l=0,c=t[i-1].nextSibling,u=null;for(;s<i||l<o;){if(t[s]===n[l]){s++,l++;continue}for(;t[i-1]===n[o-1];)i--,o--;if(i===s){const f=o<r?l?n[l-1].nextSibling:n[o-l]:c;for(;l<o;)e.insertBefore(n[l++],f)}else if(o===l)for(;s<i;)(!u||!u.has(t[s]))&&t[s].remove(),s++;else if(t[s]===n[o-1]&&n[l]===t[i-1]){const f=t[--i].nextSibling;e.insertBefore(n[l++],t[s++].nextSibling),e.insertBefore(n[--o],f),t[i]=n[o]}else{if(!u){u=new Map;let a=l;for(;a<o;)u.set(n[a],a++)}const f=u.get(t[s]);if(f!=null)if(l<f&&f<o){let a=s,d=1,g;for(;++a<i&&a<o&&!((g=u.get(t[a]))==null||g!==f+d);)d++;if(d>f-l){const m=t[s];for(;l<f;)e.insertBefore(n[l++],m)}else e.replaceChild(n[l++],t[s++])}else s++;else t[s++].remove()}}}const Yt="_$DX_DELEGATE";function Tr(e,t,n,r={}){let i;return Le(o=>{i=o,t===document?e():O(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{i(),t.textContent=""}}function re(e,t,n){let r;const i=()=>{const s=document.createElement("template");return s.innerHTML=e,s.content.firstChild},o=()=>(r||(r=i())).cloneNode(!0);return o.cloneNode=o,o}function Dr(e,t=window.document){const n=t[Yt]||(t[Yt]=new Set);for(let r=0,i=e.length;r<i;r++){const o=e[r];n.has(o)||(n.add(o),t.addEventListener(o,Ir))}}function bt(e,t,n){zt(e)||(n==null?e.removeAttribute(t):e.setAttribute(t,n))}function Sn(e,t){zt(e)||(t==null?e.removeAttribute("class"):e.className=t)}function qe(e,t,n){return V(()=>e(t,n))}function O(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return Ge(e,t,r,n);ce(i=>Ge(e,t(),i,n),r)}function zt(e){return!!I.context&&!I.done&&(!e||e.isConnected)}function Ir(e){let t=e.target;const n=`$$${e.type}`,r=e.target,i=e.currentTarget,o=c=>Object.defineProperty(e,"target",{configurable:!0,value:c}),s=()=>{const c=t[n];if(c&&!t.disabled){const u=t[`${n}Data`];if(u!==void 0?c.call(t,u,e):c.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&o(t.host),!0},l=()=>{for(;s()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const c=e.composedPath();o(c[0]);for(let u=0;u<c.length-2&&(t=c[u],!!s());u++){if(t._$host){t=t._$host,l();break}if(t.parentNode===i)break}}else l();o(r)}function Ge(e,t,n,r,i){const o=zt(e);if(o){!n&&(n=[...e.childNodes]);let c=[];for(let u=0;u<n.length;u++){const f=n[u];f.nodeType===8&&f.data.slice(0,2)==="!$"?f.remove():c.push(f)}n=c}for(;typeof n=="function";)n=n();if(t===n)return n;const s=typeof t,l=r!==void 0;if(e=l&&n[0]&&n[0].parentNode||e,s==="string"||s==="number"){if(o||s==="number"&&(t=t.toString(),t===n))return n;if(l){let c=n[0];c&&c.nodeType===3?c.data!==t&&(c.data=t):c=document.createTextNode(t),n=ve(e,n,r,c)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||s==="boolean"){if(o)return n;n=ve(e,n,r)}else{if(s==="function")return ce(()=>{let c=t();for(;typeof c=="function";)c=c();n=Ge(e,c,n,r)}),()=>n;if(Array.isArray(t)){const c=[],u=n&&Array.isArray(n);if(kt(c,t,n,i))return ce(()=>n=Ge(e,c,n,r,!0)),()=>n;if(o){if(!c.length)return n;if(r===void 0)return n=[...e.childNodes];let f=c[0];if(f.parentNode!==e)return n;const a=[f];for(;(f=f.nextSibling)!==r;)a.push(f);return n=a}if(c.length===0){if(n=ve(e,n,r),l)return n}else u?n.length===0?Jt(e,c,r):Nr(e,n,c):(n&&ve(e),Jt(e,c));n=c}else if(t.nodeType){if(o&&t.parentNode)return n=l?[t]:t;if(Array.isArray(n)){if(l)return n=ve(e,n,r,t);ve(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function kt(e,t,n,r){let i=!1;for(let o=0,s=t.length;o<s;o++){let l=t[o],c=n&&n[e.length],u;if(!(l==null||l===!0||l===!1))if((u=typeof l)=="object"&&l.nodeType)e.push(l);else if(Array.isArray(l))i=kt(e,l,c)||i;else if(u==="function")if(r){for(;typeof l=="function";)l=l();i=kt(e,Array.isArray(l)?l:[l],Array.isArray(c)?c:[c])||i}else e.push(l),i=!0;else{const f=String(l);c&&c.nodeType===3&&c.data===f?e.push(c):e.push(document.createTextNode(f))}}return i}function Jt(e,t,n=null){for(let r=0,i=t.length;r<i;r++)e.insertBefore(t[r],n)}function ve(e,t,n,r){if(n===void 0)return e.textContent="";const i=r||document.createTextNode("");if(t.length){let o=!1;for(let s=t.length-1;s>=0;s--){const l=t[s];if(i!==l){const c=l.parentNode===e;!o&&!s?c?e.replaceChild(i,l):e.insertBefore(i,n):c&&l.remove()}else o=!0}}else e.insertBefore(i,n);return[i]}const zr=["white","black"],Qe=["a","b","c","d","e","f","g","h"],Ze=["1","2","3","4","5","6","7","8"],Kr=[...Ze].reverse(),Kt=Array.prototype.concat(...Qe.map(e=>Ze.map(t=>e+t))),H=e=>Kt[8*e[0]+e[1]],P=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],Pn=Kt.map(P);function Lr(e){let t;const n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const Br=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},Lt=e=>e==="white"?"black":"white",Re=(e,t)=>{const n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r},vt=(e,t)=>e.role===t.role&&e.color===t.color,Ke=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],Q=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},En=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},Bt=(e,t)=>{e.style.visibility=t?"visible":"hidden"},be=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},$n=e=>e.button===2,te=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function On(e,t,n){const r=P(e);return t||(r[0]=7-r[0],r[1]=7-r[1]),[n.left+n.width*r[0]/8+n.width/16,n.top+n.height*(7-r[1])/8+n.height/16]}const we=(e,t)=>Math.abs(e-t),Wr=e=>(t,n,r,i)=>we(t,r)<2&&(e==="white"?i===n+1||n<=1&&i===n+2&&t===r:i===n-1||n>=6&&i===n-2&&t===r),Mn=(e,t,n,r)=>{const i=we(e,n),o=we(t,r);return i===1&&o===2||i===2&&o===1},Rn=(e,t,n,r)=>we(e,n)===we(t,r),Nn=(e,t,n,r)=>e===n||t===r,Tn=(e,t,n,r)=>Rn(e,t,n,r)||Nn(e,t,n,r),Fr=(e,t,n)=>(r,i,o,s)=>we(r,o)<2&&we(i,s)<2||n&&i===s&&i===(e==="white"?0:7)&&(r===4&&(o===2&&t.includes(0)||o===6&&t.includes(7))||t.includes(o));function jr(e,t){const n=t==="white"?"1":"8",r=[];for(const[i,o]of e)i[1]===n&&o.color===t&&o.role==="rook"&&r.push(P(i)[0]);return r}function Dn(e,t,n){const r=e.get(t);if(!r)return[];const i=P(t),o=r.role,s=o==="pawn"?Wr(r.color):o==="knight"?Mn:o==="bishop"?Rn:o==="rook"?Nn:o==="queen"?Tn:Fr(r.color,jr(e,r.color),n);return Pn.filter(l=>(i[0]!==l[0]||i[1]!==l[1])&&s(i[0],i[1],l[0],l[1])).map(H)}function W(e,...t){e&&setTimeout(()=>e(...t),1)}function Hr(e){e.orientation=Lt(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Ur(e,t){for(const[n,r]of t)r?e.pieces.set(n,r):e.pieces.delete(n)}function Vr(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[n,r]of e.pieces)r.role==="king"&&r.color===t&&(e.check=n)}function qr(e,t,n,r){he(e),e.premovable.current=[t,n],W(e.premovable.events.set,t,n,r)}function fe(e){e.premovable.current&&(e.premovable.current=void 0,W(e.premovable.events.unset))}function Gr(e,t,n){fe(e),e.predroppable.current={role:t,key:n},W(e.predroppable.events.set,t,n)}function he(e){const t=e.predroppable;t.current&&(t.current=void 0,W(t.events.unset))}function Qr(e,t,n){if(!e.autoCastle)return!1;const r=e.pieces.get(t);if(!r||r.role!=="king")return!1;const i=P(t),o=P(n);if(i[1]!==0&&i[1]!==7||i[1]!==o[1])return!1;i[0]===4&&!e.pieces.has(n)&&(o[0]===6?n=H([7,o[1]]):o[0]===2&&(n=H([0,o[1]])));const s=e.pieces.get(n);return!s||s.color!==r.color||s.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(n),i[0]<o[0]?(e.pieces.set(H([6,o[1]]),r),e.pieces.set(H([5,o[1]]),s)):(e.pieces.set(H([2,o[1]]),r),e.pieces.set(H([3,o[1]]),s)),!0)}function In(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);if(t===n||!r)return!1;const o=i&&i.color!==r.color?i:void 0;return n===e.selected&&U(e),W(e.events.move,t,n,o),Qr(e,t,n)||(e.pieces.set(n,r),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,W(e.events.change),o||!0}function Wt(e,t,n,r){if(e.pieces.has(n))if(r)e.pieces.delete(n);else return!1;return W(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,W(e.events.change),e.movable.dests=void 0,e.turnColor=Lt(e.turnColor),!0}function zn(e,t,n){const r=In(e,t,n);return r&&(e.movable.dests=void 0,e.turnColor=Lt(e.turnColor),e.animation.current=void 0),r}function Kn(e,t,n){if(Ft(e,t,n)){const r=zn(e,t,n);if(r){const i=e.hold.stop();U(e);const o={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return r!==!0&&(o.captured=r),W(e.movable.events.after,t,n,o),!0}}else if(Xr(e,t,n))return qr(e,t,n,{ctrlKey:e.stats.ctrlKey}),U(e),!0;return U(e),!1}function Ln(e,t,n,r){const i=e.pieces.get(t);i&&(Zr(e,t,n)||r)?(e.pieces.delete(t),Wt(e,i,n,r),W(e.movable.events.afterNewPiece,i.role,n,{premove:!1,predrop:!1})):i&&Yr(e,t,n)?Gr(e,i.role,n):(fe(e),he(e)),e.pieces.delete(t),U(e)}function yt(e,t,n){if(W(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){U(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&Kn(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Wn(e,t)||jt(e,t))&&(Bn(e,t),e.hold.start())}function Bn(e,t){e.selected=t,jt(e,t)?e.premovable.customDests||(e.premovable.dests=Dn(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function U(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Wn(e,t){const n=e.pieces.get(t);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const Ft=(e,t,n)=>{var r,i;return t!==n&&Wn(e,t)&&(e.movable.free||!!(!((i=(r=e.movable.dests)===null||r===void 0?void 0:r.get(t))===null||i===void 0)&&i.includes(n)))};function Zr(e,t,n){const r=e.pieces.get(t);return!!r&&(t===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}function jt(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function Xr(e,t,n){var r,i;const o=(i=(r=e.premovable.customDests)===null||r===void 0?void 0:r.get(t))!==null&&i!==void 0?i:Dn(e.pieces,t,e.premovable.castle);return t!==n&&jt(e,t)&&o.includes(n)}function Yr(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);return!!r&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(r.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===r.color&&e.turnColor!==r.color}function Jr(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function ei(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],r=t[1];let i=!1;if(Ft(e,n,r)){const o=zn(e,n,r);if(o){const s={premove:!0};o!==!0&&(s.captured=o),W(e.movable.events.after,n,r,s),i=!0}}return fe(e),i}function ti(e,t){const n=e.predroppable.current;let r=!1;if(!n)return!1;if(t(n)){const i={role:n.role,color:e.movable.color};Wt(e,i,n.key)&&(W(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),r=!0)}return he(e),r}function Ht(e){fe(e),he(e),U(e)}function en(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Ht(e)}function ke(e,t,n){let r=Math.floor(8*(e[0]-n.left)/n.width);t||(r=7-r);let i=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(i=7-i),r>=0&&r<8&&i>=0&&i<8?H([r,i]):void 0}function ni(e,t,n,r){const i=P(e),o=Pn.filter(u=>Tn(i[0],i[1],u[0],u[1])||Mn(i[0],i[1],u[0],u[1])),l=o.map(u=>On(H(u),n,r)).map(u=>Re(t,u)),[,c]=l.reduce((u,f,a)=>u[0]<f?u:[f,a],[l[0],0]);return H(o[c])}const F=e=>e.orientation==="white",Fn="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",ri={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},ii={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function jn(e){e==="start"&&(e=Fn);const t=new Map;let n=7,r=0;for(const i of e)switch(i){case" ":case"[":return t;case"/":if(--n,n<0)return t;r=0;break;case"~":{const o=t.get(H([r-1,n]));o&&(o.promoted=!0);break}default:{const o=i.charCodeAt(0);if(o<57)r+=o-48;else{const s=i.toLowerCase();t.set(H([r,n]),{role:ri[s],color:i===s?"black":"white"}),++r}}}return t}function oi(e){return Kr.map(t=>Qe.map(n=>{const r=e.get(n+t);if(r){let i=ii[r.role];return r.color==="white"&&(i=i.toUpperCase()),r.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function Hn(e,t){t.animation&&(Ut(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Un(e,t){var n,r,i;if(!((n=t.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((r=t.drawable)===null||r===void 0)&&r.autoShapes&&(e.drawable.autoShapes=[]),Ut(e,t),t.fen&&(e.pieces=jn(t.fen),e.drawable.shapes=((i=t.drawable)===null||i===void 0?void 0:i.shapes)||[]),"check"in t&&Vr(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&Bn(e,e.selected),Hn(e,t),!e.movable.rookCastle&&e.movable.dests){const o=e.movable.color==="white"?"1":"8",s="e"+o,l=e.movable.dests.get(s),c=e.pieces.get(s);if(!l||!c||c.role!=="king")return;e.movable.dests.set(s,l.filter(u=>!(u==="a"+o&&l.includes("c"+o))&&!(u==="h"+o&&l.includes("g"+o))))}}function Ut(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)&&tn(e[n])&&tn(t[n])?Ut(e[n],t[n]):e[n]=t[n])}function tn(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const pe=(e,t)=>t.animation.enabled?ci(e,t):se(e,t);function se(e,t){const n=e(t);return t.dom.redraw(),n}const ut=(e,t)=>({key:e,pos:P(e),piece:t}),si=(e,t)=>t.sort((n,r)=>Re(e.pos,n.pos)-Re(e.pos,r.pos))[0];function li(e,t){const n=new Map,r=[],i=new Map,o=[],s=[],l=new Map;let c,u,f;for(const[a,d]of e)l.set(a,ut(a,d));for(const a of Kt)c=t.pieces.get(a),u=l.get(a),c?u?vt(c,u.piece)||(o.push(u),s.push(ut(a,c))):s.push(ut(a,c)):u&&o.push(u);for(const a of s)u=si(a,o.filter(d=>vt(a.piece,d.piece))),u&&(f=[u.pos[0]-a.pos[0],u.pos[1]-a.pos[1]],n.set(a.key,f.concat(f)),r.push(u.key));for(const a of o)r.includes(a.key)||i.set(a.key,a.piece);return{anims:n,fadings:i}}function Vn(e,t){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const r=1-(t-n.start)*n.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=ai(r);for(const o of n.plan.anims.values())o[2]=o[0]*i,o[3]=o[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((o=performance.now())=>Vn(e,o))}}function ci(e,t){const n=new Map(t.pieces),r=e(t),i=li(n,t);if(i.anims.size||i.fadings.size){const o=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:i},o||Vn(t,performance.now())}else t.dom.redraw();return r}const ai=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,ui=["green","red","blue","yellow"];function fi(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?U(e):Ht(e);const n=be(t),r=ke(n,F(e),e.dom.bounds());r&&(e.drawable.current={orig:r,pos:n,brush:gi(t),snapToValidMove:e.drawable.defaultSnapToValidMove},qn(e))}function qn(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const n=ke(t.pos,F(e),e.dom.bounds());n||(t.snapToValidMove=!1);const r=t.snapToValidMove?ni(t.orig,t.pos,F(e),e.dom.bounds()):n;r!==t.mouseSq&&(t.mouseSq=r,t.dest=r!==t.orig?r:void 0,e.dom.redrawNow()),qn(e)}})}function hi(e,t){e.drawable.current&&(e.drawable.current.pos=be(t))}function di(e){const t=e.drawable.current;t&&(t.mouseSq&&mi(e.drawable,t),Gn(e))}function Gn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function pi(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Qn(e.drawable))}function gi(e){var t;const n=(e.shiftKey||e.ctrlKey)&&$n(e),r=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return ui[(n?1:0)+(r?2:0)]}function mi(e,t){const n=i=>i.orig===t.orig&&i.dest===t.dest,r=e.shapes.find(n);r&&(e.shapes=e.shapes.filter(i=>!n(i))),(!r||r.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),Qn(e)}function Qn(e){e.onChange&&e.onChange(e.shapes)}function wi(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),r=be(t),i=ke(r,F(e),n);if(!i)return;const o=e.pieces.get(i),s=e.selected;if(!s&&e.drawable.enabled&&(e.drawable.eraseOnClick||!o||o.color!==e.turnColor)&&pi(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||o||s||bi(e,r)))t.preventDefault();else if(t.touches)return;const l=!!e.premovable.current,c=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&Ft(e,e.selected,i)?pe(a=>yt(a,i),e):yt(e,i);const u=e.selected===i,f=Xn(e,i);if(o&&f&&u&&Jr(e,i)){e.draggable.current={orig:i,piece:o,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:f,previouslySelected:s,originTarget:t.target,keyHasChanged:!1},f.cgDragging=!0,f.classList.add("dragging");const a=e.dom.elements.ghost;a&&(a.className=`ghost ${o.color} ${o.role}`,Q(a,Ke(n)(P(i),F(e))),Bt(a,!0)),Vt(e)}else l&&fe(e),c&&he(e);e.dom.redraw()}function bi(e,t){const n=F(e),r=e.dom.bounds(),i=Math.pow(r.width/8,2);for(const o of e.pieces.keys()){const s=On(o,n,r);if(Re(s,t)<=i)return!0}return!1}function ki(e,t,n,r){const i="a0";e.pieces.set(i,t),e.dom.redraw();const o=be(n);e.draggable.current={orig:i,piece:t,origPos:o,pos:o,started:!0,element:()=>Xn(e,i),originTarget:n.target,newPiece:!0,force:!!r,keyHasChanged:!1},Vt(e)}function Vt(e){requestAnimationFrame(()=>{var t;const n=e.draggable.current;if(!n)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(n.orig)&&(e.animation.current=void 0);const r=e.pieces.get(n.orig);if(!r||!vt(r,n.piece))Xe(e);else if(!n.started&&Re(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const o=n.element();if(!o)return;o.cgDragging=!0,o.classList.add("dragging"),n.element=o}const i=e.dom.bounds();Q(n.element,[n.pos[0]-i.left-i.width/16,n.pos[1]-i.top-i.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==ke(n.pos,F(e),i))}Vt(e)})}function vi(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=be(t))}function yi(e,t){const n=e.draggable.current;if(!n)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}fe(e),he(e);const r=be(t)||n.pos,i=ke(r,F(e),e.dom.bounds());i&&n.started&&n.orig!==i?n.newPiece?Ln(e,n.orig,i,n.force):(e.stats.ctrlKey=t.ctrlKey,Kn(e,n.orig,i)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(n.orig),W(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===i||!i)?U(e):e.selectable.enabled||U(e),Zn(e),e.draggable.current=void 0,e.dom.redraw()}function Xe(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,U(e),Zn(e),e.dom.redraw())}function Zn(e){const t=e.dom.elements;t.ghost&&Bt(t.ghost,!1)}function Xn(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName==="PIECE")return n;n=n.nextSibling}}function Ci(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{nn(e,2),setTimeout(()=>nn(e,void 0),120)},120)}function nn(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function _i(e,t){function n(){Hr(e),t()}return{set(r){r.orientation&&r.orientation!==e.orientation&&n(),Hn(e,r),(r.fen?pe:se)(i=>Un(i,r),e)},state:e,getFen:()=>oi(e.pieces),toggleOrientation:n,setPieces(r){pe(i=>Ur(i,r),e)},selectSquare(r,i){r?pe(o=>yt(o,r,i),e):e.selected&&(U(e),e.dom.redraw())},move(r,i){pe(o=>In(o,r,i),e)},newPiece(r,i){pe(o=>Wt(o,r,i),e)},playPremove(){if(e.premovable.current){if(pe(ei,e))return!0;e.dom.redraw()}return!1},playPredrop(r){if(e.predroppable.current){const i=ti(e,r);return e.dom.redraw(),i}return!1},cancelPremove(){se(fe,e)},cancelPredrop(){se(he,e)},cancelMove(){se(r=>{Ht(r),Xe(r)},e)},stop(){se(r=>{en(r),Xe(r)},e)},explode(r){Ci(e,r)},setAutoShapes(r){se(i=>i.drawable.autoShapes=r,e)},setShapes(r){se(i=>i.drawable.shapes=r,e)},getKeyAtDomPos(r){return ke(r,F(e),e.dom.bounds())},redrawAll:t,dragNewPiece(r,i,o){ki(e,r,i,o)},destroy(){en(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function xi(){return{pieces:jn(Fn),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:Br()}}const rn={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function Ai(){const e=R("defs"),t=L(R("filter"),{id:"cg-filter-blur"});return t.appendChild(L(R("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}function Si(e,t,n){var r;const i=e.drawable,o=i.current,s=o&&o.mouseSq?o:void 0,l=new Map,c=e.dom.bounds(),u=i.autoShapes.filter(g=>!g.piece);for(const g of i.shapes.concat(u).concat(s?[s]:[])){if(!g.dest)continue;const m=(r=l.get(g.dest))!==null&&r!==void 0?r:new Set,p=et(Je(P(g.orig),e.orientation),c),w=et(Je(P(g.dest),e.orientation),c);m.add(_t(p,w)),l.set(g.dest,m)}const f=i.shapes.concat(u).map(g=>({shape:g,current:!1,hash:on(g,Ct(g.dest,l),!1,c)}));s&&f.push({shape:s,current:!0,hash:on(s,Ct(s.dest,l),!0,c)});const a=f.map(g=>g.hash).join(";");if(a===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=a;const d=t.querySelector("defs");Pi(i,f,d),Ei(f,t.querySelector("g"),n.querySelector("g"),g=>Mi(e,g,i.brushes,l,c))}function Pi(e,t,n){var r;const i=new Map;let o;for(const c of t.filter(u=>u.shape.dest&&u.shape.brush))o=Yn(e.brushes[c.shape.brush],c.shape.modifiers),!((r=c.shape.modifiers)===null||r===void 0)&&r.hilite&&i.set(Ye(o).key,Ye(o)),i.set(o.key,o);const s=new Set;let l=n.firstElementChild;for(;l;)s.add(l.getAttribute("cgKey")),l=l.nextElementSibling;for(const[c,u]of i.entries())s.has(c)||n.appendChild(Ti(u))}function Ei(e,t,n,r){const i=new Map;for(const o of e)i.set(o.hash,!1);for(const o of[t,n]){const s=[];let l=o.firstElementChild,c;for(;l;)c=l.getAttribute("cgHash"),i.has(c)?i.set(c,!0):s.push(l),l=l.nextElementSibling;for(const u of s)o.removeChild(u)}for(const o of e.filter(s=>!i.get(s.hash)))for(const s of r(o))s.isCustom?n.appendChild(s.el):t.appendChild(s.el)}function on({orig:e,dest:t,brush:n,piece:r,modifiers:i,customSvg:o,label:s},l,c,u){var f,a;return[u.width,u.height,c,e,t,n,l&&"-",r&&$i(r),i&&Oi(i),o&&`custom-${sn(o.html)},${(a=(f=o.center)===null||f===void 0?void 0:f[0])!==null&&a!==void 0?a:"o"}`,s&&`label-${sn(s.text)}`].filter(d=>d).join(",")}function $i(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function Oi(e){return[e.lineWidth,e.hilite&&"*"].filter(t=>t).join(",")}function sn(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return t.toString()}function Mi(e,{shape:t,current:n,hash:r},i,o,s){var l,c;const u=et(Je(P(t.orig),e.orientation),s),f=t.dest?et(Je(P(t.dest),e.orientation),s):u,a=t.brush&&Yn(i[t.brush],t.modifiers),d=o.get(t.dest),g=[];if(a){const m=L(R("g"),{cgHash:r});g.push({el:m}),u[0]!==f[0]||u[1]!==f[1]?m.appendChild(Ni(t,a,u,f,n,Ct(t.dest,o))):m.appendChild(Ri(i[t.brush],u,n,s))}if(t.label){const m=t.label;(l=m.fill)!==null&&l!==void 0||(m.fill=t.brush&&i[t.brush].color);const p=t.brush?void 0:"tr";g.push({el:Di(m,r,u,f,d,p),isCustom:!0})}if(t.customSvg){const m=(c=t.customSvg.center)!==null&&c!==void 0?c:"orig",[p,w]=m==="label"?er(u,f,d).map(b=>b-.5):m==="dest"?f:u,y=L(R("g"),{transform:`translate(${p},${w})`,cgHash:r});y.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,g.push({el:y,isCustom:!0})}return g}function Ri(e,t,n,r){const i=Ii(),o=(r.width+r.height)/(4*Math.max(r.width,r.height));return L(R("circle"),{stroke:e.color,"stroke-width":i[n?0:1],fill:"none",opacity:Jn(e,n),cx:t[0],cy:t[1],r:o-i[1]/2})}function Ye(e){return["#ffffff","#fff","white"].includes(e.color)?rn.hilitePrimary:rn.hiliteWhite}function Ni(e,t,n,r,i,o){var s;function l(f){var a;const d=Ki(o&&!i),g=r[0]-n[0],m=r[1]-n[1],p=Math.atan2(m,g),w=Math.cos(p)*d,y=Math.sin(p)*d;return L(R("line"),{stroke:f?Ye(t).color:t.color,"stroke-width":zi(t,i)+(f?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${f?Ye(t).key:t.key})`,opacity:!((a=e.modifiers)===null||a===void 0)&&a.hilite?1:Jn(t,i),x1:n[0],y1:n[1],x2:r[0]-w,y2:r[1]-y})}if(!(!((s=e.modifiers)===null||s===void 0)&&s.hilite))return l(!1);const c=R("g"),u=L(R("g"),{filter:"url(#cg-filter-blur)"});return u.appendChild(Li(n,r)),u.appendChild(l(!0)),c.appendChild(u),c.appendChild(l(!1)),c}function Ti(e){const t=L(R("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(L(R("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function Di(e,t,n,r,i,o){var s;const c=.4*.75**e.text.length,u=er(n,r,i),f=o==="tr"?.4:0,a=L(R("g"),{transform:`translate(${u[0]+f},${u[1]-f})`,cgHash:t});a.appendChild(L(R("circle"),{r:.4/2,"fill-opacity":o?1:.8,"stroke-opacity":o?1:.7,"stroke-width":.03,fill:(s=e.fill)!==null&&s!==void 0?s:"#666",stroke:"white"}));const d=L(R("text"),{"font-size":c,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return d.innerHTML=e.text,a.appendChild(d),a}function Je(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function Ct(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function R(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function L(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function Yn(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(n=>n).join("")}:e}function Ii(){return[3/64,4/64]}function zi(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function Jn(e,t){return(e.opacity||1)*(t?.9:1)}function Ki(e){return(e?20:10)/64}function et(e,t){const n=Math.min(1,t.width/t.height),r=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*r]}function Li(e,t){const n={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return L(R("rect"),{x:n.from[0],y:n.from[1],width:n.to[0]-n.from[0],height:n.to[1]-n.from[1],fill:"none",stroke:"none"})}function _t(e,t,n=!0){const r=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return n?(Math.round(r*8/Math.PI)+16)%16:r}function Bi(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((n,r)=>n+r*r,0))}function er(e,t,n){let r=Bi(e,t);const i=_t(e,t,!1);if(n&&(r-=33/64,n.size>1)){r-=10/64;const o=_t(e,t);(n.has((o+1)%16)||n.has((o+15)%16))&&o&1&&(r-=.4)}return[e[0]-Math.cos(i)*r,e[1]-Math.sin(i)*r].map(o=>o+.5)}function Wi(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const c of zr)e.classList.toggle("orientation-"+c,t.orientation===c);e.classList.toggle("manipulable",!t.viewOnly);const n=te("cg-container");e.appendChild(n);const r=te("cg-board");n.appendChild(r);let i,o,s;if(t.drawable.visible&&(i=L(R("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(Ai()),i.appendChild(R("g")),o=L(R("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(R("g")),s=te("cg-auto-pieces"),n.appendChild(i),n.appendChild(o),n.appendChild(s)),t.coordinates){const c=t.orientation==="black"?" black":"",u=t.ranksPosition==="left"?" left":"";if(t.coordinatesOnSquares){const f=t.orientation==="white"?a=>a+1:a=>8-a;Qe.forEach((a,d)=>n.appendChild(ft(Ze.map(g=>a+g),"squares rank"+f(d)+c+u)))}else n.appendChild(ft(Ze,"ranks"+c+u)),n.appendChild(ft(Qe,"files"+c))}let l;return t.draggable.enabled&&t.draggable.showGhost&&(l=te("piece","ghost"),Bt(l,!1),n.appendChild(l)),{board:r,container:n,wrap:e,ghost:l,svg:i,customSvg:o,autoPieces:s}}function ft(e,t){const n=te("coords",t);let r;for(const i of e)r=te("coord"),r.textContent=i,n.appendChild(r);return n}function Fi(e,t){if(!e.dropmode.active)return;fe(e),he(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const r=be(t),i=r&&ke(r,F(e),e.dom.bounds());i&&Ln(e,"a0",i)}e.dom.redraw()}function ji(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",i=>i.preventDefault()),e.viewOnly)return;const r=Ui(e);n.addEventListener("touchstart",r,{passive:!1}),n.addEventListener("mousedown",r,{passive:!1})}function Hi(e,t){const n=[];if("ResizeObserver"in window||n.push(Pe(document.body,"chessground.resize",t)),!e.viewOnly){const r=ln(e,vi,hi),i=ln(e,yi,di);for(const s of["touchmove","mousemove"])n.push(Pe(document,s,r));for(const s of["touchend","mouseup"])n.push(Pe(document,s,i));const o=()=>e.dom.bounds.clear();n.push(Pe(document,"scroll",o,{capture:!0,passive:!0})),n.push(Pe(window,"resize",o,{passive:!0}))}return()=>n.forEach(r=>r())}function Pe(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}const Ui=e=>t=>{e.draggable.current?Xe(e):e.drawable.current?Gn(e):t.shiftKey||$n(t)?e.drawable.enabled&&fi(e,t):e.viewOnly||(e.dropmode.active?Fi(e,t):wi(e,t))},ln=(e,t,n)=>r=>{e.drawable.current?e.drawable.enabled&&n(e,r):e.viewOnly||t(e,r)};function Vi(e){const t=F(e),n=Ke(e.dom.bounds()),r=e.dom.elements.board,i=e.pieces,o=e.animation.current,s=o?o.plan.anims:new Map,l=o?o.plan.fadings:new Map,c=e.draggable.current,u=Gi(e),f=new Set,a=new Set,d=new Map,g=new Map;let m,p,w,y,b,A,E,x,q,ie;for(p=r.firstChild;p;){if(m=p.cgKey,tr(p))if(w=i.get(m),b=s.get(m),A=l.get(m),y=p.cgPiece,p.cgDragging&&(!c||c.orig!==m)&&(p.classList.remove("dragging"),Q(p,n(P(m),t)),p.cgDragging=!1),!A&&p.cgFading&&(p.cgFading=!1,p.classList.remove("fading")),w){if(b&&p.cgAnimating&&y===Ee(w)){const k=P(m);k[0]+=b[2],k[1]+=b[3],p.classList.add("anim"),Q(p,n(k,t))}else p.cgAnimating&&(p.cgAnimating=!1,p.classList.remove("anim"),Q(p,n(P(m),t)),e.addPieceZIndex&&(p.style.zIndex=ht(P(m),t)));y===Ee(w)&&(!A||!p.cgFading)?f.add(m):A&&y===Ee(A)?(p.classList.add("fading"),p.cgFading=!0):dt(d,y,p)}else dt(d,y,p);else if(nr(p)){const k=p.className;u.get(m)===k?a.add(m):dt(g,k,p)}p=p.nextSibling}for(const[k,T]of u)if(!a.has(k)){q=g.get(T),ie=q&&q.pop();const N=n(P(k),t);if(ie)ie.cgKey=k,Q(ie,N);else{const j=te("square",T);j.cgKey=k,Q(j,N),r.insertBefore(j,r.firstChild)}}for(const[k,T]of i)if(b=s.get(k),!f.has(k))if(E=d.get(Ee(T)),x=E&&E.pop(),x){x.cgKey=k,x.cgFading&&(x.classList.remove("fading"),x.cgFading=!1);const N=P(k);e.addPieceZIndex&&(x.style.zIndex=ht(N,t)),b&&(x.cgAnimating=!0,x.classList.add("anim"),N[0]+=b[2],N[1]+=b[3]),Q(x,n(N,t))}else{const N=Ee(T),j=te("piece",N),de=P(k);j.cgPiece=N,j.cgKey=k,b&&(j.cgAnimating=!0,de[0]+=b[2],de[1]+=b[3]),Q(j,n(de,t)),e.addPieceZIndex&&(j.style.zIndex=ht(de,t)),r.appendChild(j)}for(const k of d.values())an(e,k);for(const k of g.values())an(e,k)}function qi(e){const t=F(e),n=Ke(e.dom.bounds());let r=e.dom.elements.board.firstChild;for(;r;)(tr(r)&&!r.cgAnimating||nr(r))&&Q(r,n(P(r.cgKey),t)),r=r.nextSibling}function cn(e){var t,n;const r=e.dom.elements.wrap.getBoundingClientRect(),i=e.dom.elements.container,o=r.height/r.width,s=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,l=s*o;i.style.width=s+"px",i.style.height=l+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("---cg-width",s+"px"),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("---cg-height",l+"px")}const tr=e=>e.tagName==="PIECE",nr=e=>e.tagName==="SQUARE";function an(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function ht(e,t){const r=e[1];return`${t?10-r:3+r}`}const Ee=e=>`${e.color} ${e.role}`;function Gi(e){var t,n,r;const i=new Map;if(e.lastMove&&e.highlight.lastMove)for(const l of e.lastMove)ee(i,l,"last-move");if(e.check&&e.highlight.check&&ee(i,e.check,"check"),e.selected&&(ee(i,e.selected,"selected"),e.movable.showDests)){const l=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(l)for(const u of l)ee(i,u,"move-dest"+(e.pieces.has(u)?" oc":""));const c=(r=(n=e.premovable.customDests)===null||n===void 0?void 0:n.get(e.selected))!==null&&r!==void 0?r:e.premovable.dests;if(c)for(const u of c)ee(i,u,"premove-dest"+(e.pieces.has(u)?" oc":""))}const o=e.premovable.current;if(o)for(const l of o)ee(i,l,"current-premove");else e.predroppable.current&&ee(i,e.predroppable.current.key,"current-premove");const s=e.exploding;if(s)for(const l of s.keys)ee(i,l,"exploding"+s.stage);return e.highlight.custom&&e.highlight.custom.forEach((l,c)=>{ee(i,c,l)}),i}function ee(e,t,n){const r=e.get(t);r?e.set(t,`${r} ${n}`):e.set(t,n)}function dt(e,t,n){const r=e.get(t);r?r.push(n):e.set(t,[n])}function Qi(e,t,n){const r=new Map,i=[];for(const l of e)r.set(l.hash,!1);let o=t.firstElementChild,s;for(;o;)s=o.getAttribute("cgHash"),r.has(s)?r.set(s,!0):i.push(o),o=o.nextElementSibling;for(const l of i)t.removeChild(l);for(const l of e)r.get(l.hash)||t.appendChild(n(l))}function Zi(e,t){const r=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:Ji(i),current:!1}));Qi(r,t,i=>Yi(e,i,e.dom.bounds()))}function Xi(e){var t;const n=F(e),r=Ke(e.dom.bounds());let i=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;i;)En(i,r(P(i.cgKey),n),i.cgScale),i=i.nextSibling}function Yi(e,{shape:t,hash:n},r){var i,o,s;const l=t.orig,c=(i=t.piece)===null||i===void 0?void 0:i.role,u=(o=t.piece)===null||o===void 0?void 0:o.color,f=(s=t.piece)===null||s===void 0?void 0:s.scale,a=te("piece",`${c} ${u}`);return a.setAttribute("cgHash",n),a.cgKey=l,a.cgScale=f,En(a,Ke(r)(P(l),F(e)),f),a}const Ji=e=>{var t,n,r;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(n=e.piece)===null||n===void 0?void 0:n.color,(r=e.piece)===null||r===void 0?void 0:r.scale].join(",")};function eo(e,t){const n=xi();Un(n,t||{});function r(){const i="dom"in n?n.dom.unbind:void 0,o=Wi(e,n),s=Lr(()=>o.board.getBoundingClientRect()),l=f=>{Vi(u),o.autoPieces&&Zi(u,o.autoPieces),!f&&o.svg&&Si(u,o.svg,o.customSvg)},c=()=>{cn(u),qi(u),o.autoPieces&&Xi(u)},u=n;return u.dom={elements:o,bounds:s,redraw:to(l),redrawNow:l,unbind:i},u.drawable.prevSvgHash="",cn(u),l(!1),ji(u,c),i||(u.dom.unbind=Hi(u,c)),u.events.insert&&u.events.insert(o),u}return _i(r(),r)}function to(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}class rr{unwrap(t,n){const r=this._chain(i=>v.ok(t?t(i):i),i=>n?v.ok(n(i)):v.err(i));if(r.isErr)throw r.error;return r.value}map(t,n){return this._chain(r=>v.ok(t(r)),r=>v.err(n?n(r):r))}chain(t,n){return this._chain(t,n||(r=>v.err(r)))}}class no extends rr{constructor(t){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=t}_chain(t,n){return t(this.value)}}class ro extends rr{constructor(t){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=t}_chain(t,n){return n(this.error)}}var v;(function(e){e.ok=function(t){return new no(t)},e.err=function(t){return new ro(t||new Error)},e.all=function(t){if(Array.isArray(t)){const i=[];for(let o=0;o<t.length;o++){const s=t[o];if(s.isErr)return s;i.push(s.value)}return e.ok(i)}const n={},r=Object.keys(t);for(let i=0;i<r.length;i++){const o=t[r[i]];if(o.isErr)return o;n[r[i]]=o.value}return e.ok(n)}})(v||(v={}));const un=e=>(e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24),xt=e=>(e=e>>>8&16711935|(e&16711935)<<8,e>>>16&65535|(e&65535)<<16),fn=e=>(e=e>>>1&1431655765|(e&1431655765)<<1,e=e>>>2&858993459|(e&858993459)<<2,e=e>>>4&252645135|(e&252645135)<<4,xt(e));class h{constructor(t,n){C(this,"lo");C(this,"hi");this.lo=t|0,this.hi=n|0}static fromSquare(t){return t>=32?new h(0,1<<t-32):new h(1<<t,0)}static fromRank(t){return new h(255,0).shl64(8*t)}static fromFile(t){return new h(16843009<<t,16843009<<t)}static empty(){return new h(0,0)}static full(){return new h(4294967295,4294967295)}static corners(){return new h(129,2164260864)}static center(){return new h(402653184,24)}static backranks(){return new h(255,4278190080)}static backrank(t){return t==="white"?new h(255,0):new h(0,4278190080)}static lightSquares(){return new h(1437226410,1437226410)}static darkSquares(){return new h(2857740885,2857740885)}complement(){return new h(~this.lo,~this.hi)}xor(t){return new h(this.lo^t.lo,this.hi^t.hi)}union(t){return new h(this.lo|t.lo,this.hi|t.hi)}intersect(t){return new h(this.lo&t.lo,this.hi&t.hi)}diff(t){return new h(this.lo&~t.lo,this.hi&~t.hi)}intersects(t){return this.intersect(t).nonEmpty()}isDisjoint(t){return this.intersect(t).isEmpty()}supersetOf(t){return t.diff(this).isEmpty()}subsetOf(t){return this.diff(t).isEmpty()}shr64(t){return t>=64?h.empty():t>=32?new h(this.hi>>>t-32,0):t>0?new h(this.lo>>>t^this.hi<<32-t,this.hi>>>t):this}shl64(t){return t>=64?h.empty():t>=32?new h(0,this.lo<<t-32):t>0?new h(this.lo<<t,this.hi<<t^this.lo>>>32-t):this}bswap64(){return new h(xt(this.hi),xt(this.lo))}rbit64(){return new h(fn(this.hi),fn(this.lo))}minus64(t){const n=this.lo-t.lo,r=(n&t.lo&1)+(t.lo>>>1)+(n>>>1)>>>31;return new h(n,this.hi-(t.hi+r))}equals(t){return this.lo===t.lo&&this.hi===t.hi}size(){return un(this.lo)+un(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(t){return(t>=32?this.hi&1<<t-32:this.lo&1<<t)!==0}set(t,n){return n?this.with(t):this.without(t)}with(t){return t>=32?new h(this.lo,this.hi|1<<t-32):new h(this.lo|1<<t,this.hi)}without(t){return t>=32?new h(this.lo,this.hi&~(1<<t-32)):new h(this.lo&~(1<<t),this.hi)}toggle(t){return t>=32?new h(this.lo,this.hi^1<<t-32):new h(this.lo^1<<t,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new h(this.lo&this.lo-1,this.hi):new h(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let t=this.lo,n=this.hi;for(;t!==0;){const r=31-Math.clz32(t&-t);t^=1<<r,yield r}for(;n!==0;){const r=31-Math.clz32(n&-n);n^=1<<r,yield 32+r}}*reversed(){let t=this.lo,n=this.hi;for(;n!==0;){const r=31-Math.clz32(n);n^=1<<r,yield 32+r}for(;t!==0;){const r=31-Math.clz32(t);t^=1<<r,yield r}}}function io(e){if(e%8!==0)return e-1}function oo(e){if((e+1)%8!==0)return e+1}function pt(e){if(e+8<64)return e+8}function gt(e){if(e-8>=0)return e-8}function so(e){let t=io(e),n=oo(e),r=pt(e),i=gt(e);return[t!==void 0?pt(t):void 0,r,n!==void 0?pt(n):void 0,t,e,n,t!==void 0?gt(t):void 0,i,n!==void 0?gt(n):void 0]}const Ae=["white","black"],Z=["pawn","knight","bishop","rook","queen","king"],lo=["a","h"],At=e=>"role"in e;let ir=class We{constructor(){C(this,"occupied");C(this,"promoted");C(this,"white");C(this,"black");C(this,"pawn");C(this,"knight");C(this,"bishop");C(this,"rook");C(this,"queen");C(this,"king")}static default(){const t=new We;return t.reset(),t}reset(){this.occupied=new h(65535,4294901760),this.promoted=h.empty(),this.white=new h(65535,0),this.black=new h(0,4294901760),this.pawn=new h(65280,16711680),this.knight=new h(66,1107296256),this.bishop=new h(36,603979776),this.rook=new h(129,2164260864),this.queen=new h(8,134217728),this.king=new h(16,268435456)}static empty(){const t=new We;return t.clear(),t}clear(){this.occupied=h.empty(),this.promoted=h.empty();for(const t of Ae)this[t]=h.empty();for(const t of Z)this[t]=h.empty()}clone(){const t=new We;t.occupied=this.occupied,t.promoted=this.promoted;for(const n of Ae)t[n]=this[n];for(const n of Z)t[n]=this[n];return t}getColor(t){if(this.white.has(t))return"white";if(this.black.has(t))return"black"}getRole(t){for(const n of Z)if(this[n].has(t))return n}get(t){const n=this.getColor(t);if(!n)return;const r=this.getRole(t),i=this.promoted.has(t);return{color:n,role:r,promoted:i}}take(t){const n=this.get(t);return n&&(this.occupied=this.occupied.without(t),this[n.color]=this[n.color].without(t),this[n.role]=this[n.role].without(t),n.promoted&&(this.promoted=this.promoted.without(t))),n}set(t,n){const r=this.take(t);return this.occupied=this.occupied.with(t),this[n.color]=this[n.color].with(t),this[n.role]=this[n.role].with(t),n.promoted&&(this.promoted=this.promoted.with(t)),r}has(t){return this.occupied.has(t)}*[Symbol.iterator](){for(const t of this.occupied)yield[t,this.get(t)]}pieces(t,n){return this[t].intersect(this[n])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(t){return this.pieces(t,"king").singleSquare()}};class X{constructor(){C(this,"pawn");C(this,"knight");C(this,"bishop");C(this,"rook");C(this,"queen");C(this,"king")}static empty(){const t=new X;for(const n of Z)t[n]=0;return t}static fromBoard(t,n){const r=new X;for(const i of Z)r[i]=t.pieces(n,i).size();return r}clone(){const t=new X;for(const n of Z)t[n]=this[n];return t}equals(t){return Z.every(n=>this[n]===t[n])}add(t){const n=new X;for(const r of Z)n[r]=this[r]+t[r];return n}subtract(t){const n=new X;for(const r of Z)n[r]=this[r]-t[r];return n}nonEmpty(){return Z.some(t=>this[t]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class ge{constructor(t,n){C(this,"white");C(this,"black");this.white=t,this.black=n}static empty(){return new ge(X.empty(),X.empty())}static fromBoard(t){return new ge(X.fromBoard(t,"white"),X.fromBoard(t,"black"))}clone(){return new ge(this.white.clone(),this.black.clone())}equals(t){return this.white.equals(t.white)&&this.black.equals(t.black)}add(t){return new ge(this.white.add(t.white),this.black.add(t.black))}subtract(t){return new ge(this.white.subtract(t.white),this.black.subtract(t.black))}count(t){return this.white[t]+this.black[t]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class Ne{constructor(t,n){C(this,"white");C(this,"black");this.white=t,this.black=n}static default(){return new Ne(3,3)}clone(){return new Ne(this.white,this.black)}equals(t){return this.white===t.white&&this.black===t.black}}const _=e=>e!==void 0,B=e=>e==="white"?"black":"white",st=e=>e>>3,Te=e=>e&7,St=(e,t)=>0<=e&&e<8&&0<=t&&t<8?e+8*t:void 0;function co(e){switch(e.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function Fe(e){if(e.length===2)return St(e.charCodeAt(0)-97,e.charCodeAt(1)-49)}const qt=(e,t)=>e==="white"?t==="a"?2:6:t==="a"?58:62,Gt=(e,t)=>e==="white"?t==="a"?3:5:t==="a"?59:61,ao="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",uo=ao+" w KQkq -",fo=uo+" 0 1";var M;(function(e){e.Fen="ERR_FEN",e.Board="ERR_BOARD",e.Pockets="ERR_POCKETS",e.Turn="ERR_TURN",e.Castling="ERR_CASTLING",e.EpSquare="ERR_EP_SQUARE",e.RemainingChecks="ERR_REMAINING_CHECKS",e.Halfmoves="ERR_HALFMOVES",e.Fullmoves="ERR_FULLMOVES"})(M||(M={}));class D extends Error{}const ho=(e,t,n)=>{let r=e.indexOf(t);for(;n-- >0&&r!==-1;)r=e.indexOf(t,r+t.length);return r},xe=e=>/^\d{1,4}$/.test(e)?parseInt(e,10):void 0,or=e=>{const t=co(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}},mt=e=>{const t=ir.empty();let n=7,r=0;for(let i=0;i<e.length;i++){const o=e[i];if(o==="/"&&r===8)r=0,n--;else{const s=parseInt(o,10);if(s>0)r+=s;else{if(r>=8||n<0)return v.err(new D(M.Board));const l=r+n*8,c=or(o);if(!c)return v.err(new D(M.Board));e[i+1]==="~"&&(c.promoted=!0,i++),t.set(l,c),r++}}}return n!==0||r!==8?v.err(new D(M.Board)):v.ok(t)},hn=e=>{if(e.length>64)return v.err(new D(M.Pockets));const t=ge.empty();for(const n of e){const r=or(n);if(!r)return v.err(new D(M.Pockets));t[r.color][r.role]++}return v.ok(t)},po=(e,t)=>{let n=h.empty();if(t==="-")return v.ok(n);for(const r of t){const i=r.toLowerCase(),o=r===i?"black":"white",s=o==="white"?0:7;if("a"<=i&&i<="h")n=n.with(St(i.charCodeAt(0)-97,s));else if(i==="k"||i==="q"){const l=e[o].intersect(h.backrank(o)).intersect(e.rook.union(e.king)),c=i==="k"?l.last():l.first();n=n.with(_(c)&&e.rook.has(c)?c:St(i==="k"?7:0,s))}else return v.err(new D(M.Castling))}return Ae.some(r=>h.backrank(r).intersect(n).size()>2)?v.err(new D(M.Castling)):v.ok(n)},dn=e=>{const t=e.split("+");if(t.length===3&&t[0]===""){const n=xe(t[1]),r=xe(t[2]);return!_(n)||n>3||!_(r)||r>3?v.err(new D(M.RemainingChecks)):v.ok(new Ne(3-n,3-r))}else if(t.length===2){const n=xe(t[0]),r=xe(t[1]);return!_(n)||n>3||!_(r)||r>3?v.err(new D(M.RemainingChecks)):v.ok(new Ne(n,r))}else return v.err(new D(M.RemainingChecks))},go=e=>{const t=e.split(/[\s_]+/),n=t.shift();let r,i=v.ok(void 0);if(n.endsWith("]")){const l=n.indexOf("[");if(l===-1)return v.err(new D(M.Fen));r=mt(n.slice(0,l)),i=hn(n.slice(l+1,-1))}else{const l=ho(n,"/",7);l===-1?r=mt(n):(r=mt(n.slice(0,l)),i=hn(n.slice(l+1)))}let o;const s=t.shift();if(!_(s)||s==="w")o="white";else if(s==="b")o="black";else return v.err(new D(M.Turn));return r.chain(l=>{const c=t.shift(),u=_(c)?po(l,c):v.ok(h.empty()),f=t.shift();let a;if(_(f)&&f!=="-"&&(a=Fe(f),!_(a)))return v.err(new D(M.EpSquare));let d=t.shift(),g;_(d)&&d.includes("+")&&(g=dn(d),d=t.shift());const m=_(d)?xe(d):0;if(!_(m))return v.err(new D(M.Halfmoves));const p=t.shift(),w=_(p)?xe(p):1;if(!_(w))return v.err(new D(M.Fullmoves));const y=t.shift();let b=v.ok(void 0);if(_(y)){if(_(g))return v.err(new D(M.RemainingChecks));b=dn(y)}else _(g)&&(b=g);return t.length>0?v.err(new D(M.Fen)):i.chain(A=>u.chain(E=>b.map(x=>({board:l,pockets:A,turn:o,castlingRights:E,remainingChecks:x,epSquare:a,halfmoves:m,fullmoves:Math.max(1,w)}))))})};var mo=re('<div class="is2d chessboard">');const wo=e=>{let t,n;return vr(()=>{let r=e.color,i=e.dests,o={premovable:{enabled:!1},movable:{color:r,free:!1,dests:i,events:{after:e.onMoveAfter}},drawable:{onChange:e.onShapes}};n=eo(t,o)}),Y(()=>{let r,i;e.fen_uci?[r,i]=e.fen_uci:r=fo;let o=[];i&&(o.push(i.slice(0,2)),o.push(i.slice(2,4)));let s=e.movable?e.color:void 0;n.set({fen:r,lastMove:o,turnColor:e.color,movable:{color:s,dests:e.dests}})}),Y(()=>{let r=e.orientation??"white";n.set({orientation:r})}),Y(()=>{let r=e.doPromotion;if(r){let i=n.state.pieces.get(r);n.setPieces(new Map([[r,{color:i.color,role:"queen",promoted:!0}]]))}}),Y(()=>{e.shapes&&n.setAutoShapes(e.shapes)}),(()=>{var r=mo();return qe(i=>t=i,r),r})()};function bo(e){return new Worker(""+new URL("worker-CKxRgWhg.js",import.meta.url).href,{name:e==null?void 0:e.name})}const lt=Cr(),ko=e=>{let t=new bo({});const[n,r]=G(),[i,o]=G(),[s,l]=G(),[c,u]=G();t.onerror=a=>{r(a.message)},t.onmessage=a=>{switch(a.data.t){case"progress":o(a.data.d);return;case"puzzles":let{all:d,filtered:g}=a.data.d;u(g),l(d);return}};let f={error:n,progress:i,puzzles:c,all_puzzles:s,filter_puzzles(a){t.postMessage({t:"filter",d:a})},set_patterns(a){t.postMessage({t:"cancel"}),t.postMessage({t:"patterns",d:a})}};return K(lt.Provider,{value:f,get children(){return e.children}})},sr=e=>{let t=Object.keys(e.has_tags).length,n={...e.has_tags};return t>0&&(n.has_tag=!0,t===1?n.single_tag=!0:n.many_tags=!0),n[`id_${e.id}`]=!0,n},vo=e=>({...e.tags,...sr(e)}),yo=Symbol("store-raw"),Co=Symbol("store-node"),ye=Symbol("store-has"),_o=Symbol("store-self");function De(e){let t;return e!=null&&typeof e=="object"&&(e[wr]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function Pt(e,t=new Set){let n,r,i,o;if(n=e!=null&&e[yo])return n;if(!De(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let s=0,l=e.length;s<l;s++)i=e[s],(r=Pt(i,t))!==i&&(e[s]=r)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const s=Object.keys(e),l=Object.getOwnPropertyDescriptors(e);for(let c=0,u=s.length;c<u;c++)o=s[c],!l[o].get&&(i=e[o],(r=Pt(i,t))!==i&&(e[o]=r))}return e}function xo(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function pn(e,t,n){if(e[t])return e[t];const[r,i]=G(n,{equals:!1,internal:!0});return r.$=i,e[t]=r}function oe(e,t,n,r=!1){if(!r&&e[t]===n)return;const i=e[t],o=e.length;n===void 0?(delete e[t],e[ye]&&e[ye][t]&&i!==void 0&&e[ye][t].$()):(e[t]=n,e[ye]&&e[ye][t]&&i===void 0&&e[ye][t].$());let s=xo(e,Co),l;if((l=pn(s,t,i))&&l.$(()=>n),Array.isArray(e)&&e.length!==o){for(let c=e.length;c<o;c++)(l=s[c])&&l.$();(l=pn(s,"length",o))&&l.$(e.length)}(l=s[_o])&&l.$()}const Et=Symbol("store-root");function _e(e,t,n,r,i){const o=t[n];if(e===o)return;const s=Array.isArray(e);if(n!==Et&&(!De(e)||!De(o)||s!==Array.isArray(o)||i&&e[i]!==o[i])){oe(t,n,e);return}if(s){if(e.length&&o.length&&(!r||i&&e[0]&&e[0][i]!=null)){let u,f,a,d,g,m,p,w;for(a=0,d=Math.min(o.length,e.length);a<d&&(o[a]===e[a]||i&&o[a]&&e[a]&&o[a][i]===e[a][i]);a++)_e(e[a],o,a,r,i);const y=new Array(e.length),b=new Map;for(d=o.length-1,g=e.length-1;d>=a&&g>=a&&(o[d]===e[g]||i&&o[a]&&e[a]&&o[d][i]===e[g][i]);d--,g--)y[g]=o[d];if(a>g||a>d){for(f=a;f<=g;f++)oe(o,f,e[f]);for(;f<e.length;f++)oe(o,f,y[f]),_e(e[f],o,f,r,i);o.length>e.length&&oe(o,"length",e.length);return}for(p=new Array(g+1),f=g;f>=a;f--)m=e[f],w=i&&m?m[i]:m,u=b.get(w),p[f]=u===void 0?-1:u,b.set(w,f);for(u=a;u<=d;u++)m=o[u],w=i&&m?m[i]:m,f=b.get(w),f!==void 0&&f!==-1&&(y[f]=o[u],f=p[f],b.set(w,f));for(f=a;f<e.length;f++)f in y?(oe(o,f,y[f]),_e(e[f],o,f,r,i)):oe(o,f,e[f])}else for(let u=0,f=e.length;u<f;u++)_e(e[u],o,u,r,i);o.length>e.length&&oe(o,"length",e.length);return}const l=Object.keys(e);for(let u=0,f=l.length;u<f;u++)_e(e[l[u]],o,l[u],r,i);const c=Object.keys(o);for(let u=0,f=c.length;u<f;u++)e[c[u]]===void 0&&oe(o,c[u],void 0)}function Ao(e,t={}){const{merge:n,key:r="id"}=t,i=Pt(e);return o=>{if(!De(o)||!De(i))return i;const s=_e(i,{[Et]:o},Et,n,r);return s===void 0?o:s}}var So=e=>(typeof e.clear=="function"||(e.clear=()=>{let t;for(;t=e.key(0);)e.removeItem(t)}),e),Po=["clear","getItem","getAll","setItem","removeItem","key","getLength"],Eo=e=>(e.withOptions=t=>Po.reduce((n,r)=>(typeof e[r]=="function"&&(n[r]=(...i)=>(i[e[r].length-1]=t,e[r](...i))),n),{get length(){return e.length},withOptions:n=>e.withOptions(n)}),e),$o={domain:"Domain",expires:"Expires",path:"Path",secure:"Secure",httpOnly:"HttpOnly",maxAge:"Max-Age",sameSite:"SameSite"};function Oo(e){if(!e)return"";const t=Object.entries(e).map(([n,r])=>{const i=$o[n];if(i)return r instanceof Date?`${i}=${r.toUTCString()}`:typeof r=="boolean"?r?`${i}`:void 0:`${i}=${r}`}).filter(n=>!!n);return t.length!=0?`; ${t.join("; ")}`:""}function Mo(e,t){var r;const n=(r=e.match(`(^|;)\\s*${t}\\s*=\\s*([^;]+)`))==null?void 0:r.pop();return n!=null?decodeURIComponent(n):null}var $e=Eo(So({_read:()=>document.cookie,_write:(e,t,n)=>{document.cookie=`${e}=${t}${Oo(n)}`},getItem:(e,t)=>Mo($e._read(t),e),setItem:(e,t,n)=>{$e._write(e,t.replace(/[\u00c0-\uffff\&;]/g,r=>encodeURIComponent(r)),n)},removeItem:(e,t)=>{$e._write(e,"deleted",{...t,expires:new Date(0)})},key:(e,t)=>{let n=null,r=0;return $e._read(t).replace(/(?:^|;)\s*(.+?)\s*=\s*[^;]+/g,(i,o)=>(!n&&o&&r++===e&&(n=o),"")),n},getLength:e=>{let t=0;return $e._read(e).replace(/(?:^|;)\s*.+?\s*=\s*[^;]+/g,n=>(t+=n?1:0,"")),t},get length(){return this.getLength()}}));function Ro(e,t={}){var f;const n=t.storage||globalThis.localStorage,r=t.name||`storage-${Mr()}`;if(!n)return[e[0],e[1],null];const i=t.storageOptions,o=t.serialize||JSON.stringify.bind(JSON),s=t.deserialize||JSON.parse.bind(JSON),l=n.getItem(r,i),c=typeof e[0]=="function"?a=>{try{const d=s(a);e[1](()=>d)}catch{}}:a=>{try{const d=s(a);e[1](Ao(d))}catch{}};let u=!0;if(l instanceof Promise?l.then(a=>u&&a&&c(a)):l&&c(l),typeof((f=t.sync)==null?void 0:f[0])=="function"){const a=typeof e[0]=="function"?e[0]:()=>e[0];t.sync[0](d=>{d.key!==r||(d.url||globalThis.location.href)!==globalThis.location.href||d.newValue===o(V(a))||c(d.newValue)})}return[e[0],typeof e[0]=="function"?a=>{var m;const d=e[1](a),g=a!=null?o(d):a;return(m=t.sync)==null||m[1](r,g),g!=null?n.setItem(r,g,i):n.removeItem(r,i),u=!1,d}:(...a)=>{var g;e[1](...a);const d=o(V(()=>e[0]));(g=t.sync)==null||g[1](r,d),n.setItem(r,d,i),u=!1},l]}const lr=(e,t,n)=>Ro(G(e),{name:`.checkmate2002.v0.${t}`}),tt=(e,t)=>{let n=h.empty();for(const r of t){const i=e+r;0<=i&&i<64&&Math.abs(Te(e)-Te(i))<=2&&(n=n.with(i))}return n},ae=e=>{const t=[];for(let n=0;n<64;n++)t[n]=e(n);return t},No=ae(e=>tt(e,[-9,-8,-7,-1,1,7,8,9])),To=ae(e=>tt(e,[-17,-15,-10,-6,6,10,15,17])),Do={white:ae(e=>tt(e,[7,9])),black:ae(e=>tt(e,[-7,-9]))},cr=e=>No[e],ar=e=>To[e],ct=(e,t)=>Do[e][t],$t=ae(e=>h.fromFile(Te(e)).without(e)),Ot=ae(e=>h.fromRank(st(e)).without(e)),Mt=ae(e=>{const t=new h(134480385,2151686160),n=8*(st(e)-Te(e));return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}),Rt=ae(e=>{const t=new h(270549120,16909320),n=8*(st(e)+Te(e)-7);return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}),Nt=(e,t,n)=>{let r=n.intersect(t),i=r.bswap64();return r=r.minus64(e),i=i.minus64(e.bswap64()),r.xor(i.bswap64()).intersect(t)},Io=(e,t)=>Nt(h.fromSquare(e),$t[e],t),zo=(e,t)=>{const n=Ot[e];let r=t.intersect(n),i=r.rbit64();return r=r.minus64(h.fromSquare(e)),i=i.minus64(h.fromSquare(63-e)),r.xor(i.rbit64()).intersect(n)},nt=(e,t)=>{const n=h.fromSquare(e);return Nt(n,Mt[e],t).xor(Nt(n,Rt[e],t))},rt=(e,t)=>Io(e,t).xor(zo(e,t)),Ko=(e,t)=>nt(e,t).xor(rt(e,t)),ur=(e,t)=>{const n=h.fromSquare(t);return Ot[e].intersects(n)?Ot[e].with(e):Rt[e].intersects(n)?Rt[e].with(e):Mt[e].intersects(n)?Mt[e].with(e):$t[e].intersects(n)?$t[e].with(e):h.empty()},Ie=(e,t)=>ur(e,t).intersect(h.full().shl64(e).xor(h.full().shl64(t))).withoutFirst();var le;(function(e){e.Empty="ERR_EMPTY",e.OppositeCheck="ERR_OPPOSITE_CHECK",e.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",e.Kings="ERR_KINGS",e.Variant="ERR_VARIANT"})(le||(le={}));class Ce extends Error{}const Lo=(e,t,n,r)=>n[t].intersect(rt(e,r).intersect(n.rooksAndQueens()).union(nt(e,r).intersect(n.bishopsAndQueens())).union(ar(e).intersect(n.knight)).union(cr(e).intersect(n.king)).union(ct(B(t),e).intersect(n.pawn)));class me{constructor(){C(this,"castlingRights");C(this,"rook");C(this,"path")}static default(){const t=new me;return t.castlingRights=h.corners(),t.rook={white:{a:0,h:7},black:{a:56,h:63}},t.path={white:{a:new h(14,0),h:new h(96,0)},black:{a:new h(0,234881024),h:new h(0,1610612736)}},t}static empty(){const t=new me;return t.castlingRights=h.empty(),t.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},t.path={white:{a:h.empty(),h:h.empty()},black:{a:h.empty(),h:h.empty()}},t}clone(){const t=new me;return t.castlingRights=this.castlingRights,t.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},t.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},t}add(t,n,r,i){const o=qt(t,n),s=Gt(t,n);this.castlingRights=this.castlingRights.with(i),this.rook[t][n]=i,this.path[t][n]=Ie(i,s).with(s).union(Ie(r,o).with(o)).without(r).without(i)}static fromSetup(t){const n=me.empty(),r=t.castlingRights.intersect(t.board.rook);for(const i of Ae){const o=h.backrank(i),s=t.board.kingOf(i);if(!_(s)||!o.has(s))continue;const l=r.intersect(t.board[i]).intersect(o),c=l.first();_(c)&&c<s&&n.add(i,"a",s,c);const u=l.last();_(u)&&s<u&&n.add(i,"h",s,u)}return n}discardRook(t){if(this.castlingRights.has(t)){this.castlingRights=this.castlingRights.without(t);for(const n of Ae)for(const r of lo)this.rook[n][r]===t&&(this.rook[n][r]=void 0)}}discardColor(t){this.castlingRights=this.castlingRights.diff(h.backrank(t)),this.rook[t].a=void 0,this.rook[t].h=void 0}}class Bo{constructor(t){C(this,"rules");C(this,"board");C(this,"pockets");C(this,"turn");C(this,"castles");C(this,"epSquare");C(this,"remainingChecks");C(this,"halfmoves");C(this,"fullmoves");this.rules=t}reset(){this.board=ir.default(),this.pockets=void 0,this.turn="white",this.castles=me.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(t){this.board=t.board.clone(),this.board.promoted=h.empty(),this.pockets=void 0,this.turn=t.turn,this.castles=me.fromSetup(t),this.epSquare=Fo(this,t.epSquare),this.remainingChecks=void 0,this.halfmoves=t.halfmoves,this.fullmoves=t.fullmoves}kingAttackers(t,n,r){return Lo(t,n,this.board,r)}playCaptureAt(t,n){this.halfmoves=0,n.role==="rook"&&this.castles.discardRook(t),this.pockets&&this.pockets[B(n.color)][n.promoted?"pawn":n.role]++}ctx(){const t=this.isVariantEnd(),n=this.board.kingOf(this.turn);if(!_(n))return{king:n,blockers:h.empty(),checkers:h.empty(),variantEnd:t,mustCapture:!1};const r=rt(n,h.empty()).intersect(this.board.rooksAndQueens()).union(nt(n,h.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[B(this.turn)]);let i=h.empty();for(const s of r){const l=Ie(n,s).intersect(this.board.occupied);l.moreThanOne()||(i=i.union(l))}const o=this.kingAttackers(n,B(this.turn),this.board.occupied);return{king:n,blockers:i,checkers:o,variantEnd:t,mustCapture:!1}}clone(){var n,r;const t=new this.constructor;return t.board=this.board.clone(),t.pockets=(n=this.pockets)==null?void 0:n.clone(),t.turn=this.turn,t.castles=this.castles.clone(),t.epSquare=this.epSquare,t.remainingChecks=(r=this.remainingChecks)==null?void 0:r.clone(),t.halfmoves=this.halfmoves,t.fullmoves=this.fullmoves,t}validate(){if(this.board.occupied.isEmpty())return v.err(new Ce(le.Empty));if(this.board.king.size()!==2)return v.err(new Ce(le.Kings));if(!_(this.board.kingOf(this.turn)))return v.err(new Ce(le.Kings));const t=this.board.kingOf(B(this.turn));return _(t)?this.kingAttackers(t,this.turn,this.board.occupied).nonEmpty()?v.err(new Ce(le.OppositeCheck)):h.backranks().intersects(this.board.pawn)?v.err(new Ce(le.PawnsOnBackrank)):v.ok(void 0):v.err(new Ce(le.Kings))}dropDests(t){return h.empty()}dests(t,n){if(n=n||this.ctx(),n.variantEnd)return h.empty();const r=this.board.get(t);if(!r||r.color!==this.turn)return h.empty();let i,o;if(r.role==="pawn"){i=ct(this.turn,t);const s=this.turn==="white"?8:-8,l=t+s;if(0<=l&&l<64&&!this.board.occupied.has(l)){i=i.with(l);const c=this.turn==="white"?t<16:t>=48,u=l+s;c&&!this.board.occupied.has(u)&&(i=i.with(u))}_(this.epSquare)&&Ho(this,t,n)&&(o=h.fromSquare(this.epSquare))}else r.role==="bishop"?i=nt(t,this.board.occupied):r.role==="knight"?i=ar(t):r.role==="rook"?i=rt(t,this.board.occupied):r.role==="queen"?i=Ko(t,this.board.occupied):i=cr(t);if(_(n.king)){if(r.role==="king"){this.board.occupied.without(t);for(const s of i);return i.union(gn(this,"a",n)).union(gn(this,"h",n))}if(n.checkers.nonEmpty()){const s=n.checkers.singleSquare();if(!_(s))return h.empty();i=i.intersect(Ie(s,n.king).with(s))}n.blockers.has(t)&&(i=i.intersect(ur(t,n.king)))}return o&&(i=i.union(o)),i}isVariantEnd(){return!1}variantOutcome(t){}hasInsufficientMaterial(t){return this.board[t].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[t].intersects(this.board.knight)?this.board[t].size()<=2&&this.board[B(t)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[t].intersects(this.board.bishop)?(!this.board.bishop.intersects(h.darkSquares())||!this.board.bishop.intersects(h.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var t,n;return{board:this.board.clone(),pockets:(t=this.pockets)==null?void 0:t.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:jo(this),remainingChecks:(n=this.remainingChecks)==null?void 0:n.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return Ae.every(t=>this.hasInsufficientMaterial(t))}hasDests(t){t=t||this.ctx();for(const n of this.board[this.turn])if(this.dests(n,t).nonEmpty())return!0;return this.dropDests(t).nonEmpty()}isLegal(t,n){if(At(t))return!this.pockets||this.pockets[this.turn][t.role]<=0||t.role==="pawn"&&h.backranks().has(t.to)?!1:this.dropDests(n).has(t.to);{if(t.promotion==="pawn"||t.promotion==="king"&&this.rules!=="antichess"||!!t.promotion!==(this.board.pawn.has(t.from)&&h.backranks().has(t.to)))return!1;const r=this.dests(t.from,n);return r.has(t.to)||r.has(Uo(this,t).to)}}isCheck(){const t=this.board.kingOf(this.turn);return _(t)&&this.kingAttackers(t,B(this.turn),this.board.occupied).nonEmpty()}isEnd(t){return(t?t.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(t)}isCheckmate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.nonEmpty()&&!this.hasDests(t)}isStalemate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.isEmpty()&&!this.hasDests(t)}outcome(t){const n=this.variantOutcome(t);return n||(t=t||this.ctx(),this.isCheckmate(t)?{winner:B(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(t)?{winner:void 0}:void 0)}allDests(t){t=t||this.ctx();const n=new Map;if(t.variantEnd)return n;for(const r of this.board[this.turn])n.set(r,this.dests(r,t));return n}play(t){const n=this.turn,r=this.epSquare,i=fr(this,t);if(this.epSquare=void 0,this.halfmoves+=1,n==="black"&&(this.fullmoves+=1),this.turn=B(n),At(t))this.board.set(t.to,{role:t.role,color:n}),this.pockets&&this.pockets[n][t.role]--,t.role==="pawn"&&(this.halfmoves=0);else{const o=this.board.take(t.from);if(!o)return;let s;if(o.role==="pawn"){this.halfmoves=0,t.to===r&&(s=this.board.take(t.to+(n==="white"?-8:8)));const l=t.from-t.to;Math.abs(l)===16&&8<=t.from&&t.from<=55&&(this.epSquare=t.from+t.to>>1),t.promotion&&(o.role=t.promotion,o.promoted=!!this.pockets)}else if(o.role==="rook")this.castles.discardRook(t.from);else if(o.role==="king"){if(i){const l=this.castles.rook[n][i];if(_(l)){const c=this.board.take(l);this.board.set(qt(n,i),o),c&&this.board.set(Gt(n,i),c)}}this.castles.discardColor(n)}if(!i){const l=this.board.set(t.to,o)||s;l&&this.playCaptureAt(t.to,l)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[n]=Math.max(this.remainingChecks[n]-1,0))}}class Wo extends Bo{constructor(){super("chess")}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const n=new this;return n.setupUnchecked(t),n.validate().map(r=>n)}clone(){return super.clone()}}const Fo=(e,t)=>{if(!_(t))return;const n=e.turn==="white"?5:2,r=e.turn==="white"?8:-8;if(st(t)!==n||e.board.occupied.has(t+r))return;const i=t-r;if(!(!e.board.pawn.has(i)||!e.board[B(e.turn)].has(i)))return t},jo=e=>{if(!_(e.epSquare))return;const t=e.ctx(),r=e.board.pieces(e.turn,"pawn").intersect(ct(B(e.turn),e.epSquare));for(const i of r)if(e.dests(i,t).has(e.epSquare))return e.epSquare},Ho=(e,t,n)=>{if(!_(e.epSquare)||!ct(e.turn,t).has(e.epSquare))return!1;if(!_(n.king))return!0;const r=e.turn==="white"?8:-8,i=e.epSquare-r;return e.kingAttackers(n.king,B(e.turn),e.board.occupied.toggle(t).toggle(i).with(e.epSquare)).without(i).isEmpty()},gn=(e,t,n)=>{if(!_(n.king)||n.checkers.nonEmpty())return h.empty();const r=e.castles.rook[e.turn][t];if(!_(r)||e.castles.path[e.turn][t].intersects(e.board.occupied))return h.empty();const i=qt(e.turn,t),o=Ie(n.king,i),s=e.board.occupied.without(n.king);for(const u of o)if(e.kingAttackers(u,B(e.turn),s).nonEmpty())return h.empty();const l=Gt(e.turn,t),c=e.board.occupied.toggle(n.king).toggle(r).toggle(l);return e.kingAttackers(i,B(e.turn),c).nonEmpty()?h.empty():h.fromSquare(r)},fr=(e,t)=>{if(At(t))return;const n=t.to-t.from;if(!(Math.abs(n)!==2&&!e.board[e.turn].has(t.to))&&e.board.king.has(t.from))return n>0?"h":"a"},Uo=(e,t)=>{const n=fr(e,t);if(!n)return t;const r=e.castles.rook[e.turn][n];return{from:t.from,to:_(r)?r:t.to}};var Vo=re("<div class=checkmate-2002>"),qo=re("<div class=progress> <!>/<!> "),Go=re('<div class=puzzles><div class=filter><input type=text placeholder="Filter y_filter _!_ n_filter"><span>/10000 Positions</span></div><div class=list>'),Qo=re("<div><span class=id><a target=_blank></a></span><span class=has-tags></span><span class=tags>"),mn=re("<span class=tag>"),Zo=re('<div class=pattern-view><div class=list></div><small class=nb> Patterns</small><div class=controls><input class=name type=text placeholder="Pattern Name"><textarea placeholder=OoOoOoFnFnFnfofofo class=pattern rows=3 cols=6 maxlength=18></textarea><button>Add Pattern</button><button class=delete>Delete'),Xo=re("<div><span class=name></span><span class=value></span><span class=nb>"),Yo=re("<div class=board><div class=buttons><button>Flip Colors</button></div><div class=b-wrap></div><div class=fen><input type=text> <button>Copy Fen");function Jo(){return K(ko,{get children(){return K(es,{})}})}function es(){const[e,t]=G(),[n,r]=G();return(()=>{var i=Vo();return O(i,K(is,{on_pattern:r,get fen(){return e()}}),null),O(i,K(rs,{get pattern(){return n()}}),null),O(i,K(ns,{on_selected_fen:t}),null),O(i,K(ts,{}),null),i})()}const ts=()=>{const{progress:e}=Dt(lt);return K(An,{get when(){return e()},children:t=>(()=>{var n=qo(),r=n.firstChild,i=r.nextSibling,o=i.nextSibling,s=o.nextSibling;return s.nextSibling,O(n,()=>t()[0],i),O(n,()=>t()[1],s),n})()})},it=class it{constructor(t){this.puzzle=t}get id(){return this.puzzle.id}get fen(){return this.puzzle.fen}get tags(){return this.puzzle.tags}get has_tags(){return sr(this.puzzle)}get all_tags(){return vo(this.puzzle)}};C(it,"create",t=>new it(t));let Tt=it;const ns=e=>{let{puzzles:t,filter_puzzles:n}=Dt(lt);const[r,i]=lr(void 0,"filter"),o=J(xn(()=>t(),Tt.create)),[s,l]=G(),c=J(()=>{var a;return(a=o().find(d=>d.id===s()))==null?void 0:a.fen});Y(Oe(c,a=>{var d;a?e.on_selected_fen(a):l((d=o()[0])==null?void 0:d.id)})),Y(Oe(r,a=>{n(a)}));let u;const f=a=>{i(a)};return(()=>{var a=Go(),d=a.firstChild,g=d.firstChild,m=g.nextSibling,p=m.firstChild,w=d.nextSibling;return qe(y=>u=y,g),g.$$input=()=>f(u.value),bt(g,"spellcheck",!1),O(m,()=>o().length,p),O(w,K(An,{get when(){return o()},children:y=>K(Be,{get each(){return y().slice(0,1e3)},children:b=>(()=>{var A=Qo(),E=A.firstChild,x=E.firstChild,q=E.nextSibling,ie=q.nextSibling;return A.$$click=()=>l(b.id),O(x,()=>b.id),O(q,K(Be,{get each(){return Object.keys(b.has_tags).filter(k=>!k.includes("id_"))},children:k=>(()=>{var T=mn();return O(T,k),T})()})),O(ie,K(Be,{get each(){return Object.keys(b.tags)},children:k=>(()=>{var T=mn();return O(T,k),T})()})),ce(k=>{var T="puzzle"+(b.id===s()?" active":""),N=`https://lichess.org/training/${b.id}`;return T!==k.e&&Sn(A,k.e=T),N!==k.t&&bt(x,"href",k.t=N),k},{e:void 0,t:void 0}),A})()})})),ce(()=>g.value=r()),a})()},rs=e=>{const{all_puzzles:t,set_patterns:n}=Dt(lt),r=[{name:"backrank",pattern:"OoOoOofnfnfnFoFoFo"}],[i,o]=lr([],"patterns"),s=J(()=>[...i(),...r]),[l,c]=G(0),u=J(()=>s()[l()]);Y(Oe(s,p=>{n(p)})),Y(Oe(u,p=>{d.value=p.name,g.value=p.pattern}));const f=()=>{let p=d.value,w=g.value;if(p="backrank",!p||p.length<3||!w||w.length!==18)return!1;r.find(y=>y.name===p)&&(p+=Math.random().toString(16).slice(2,5)),Zt(()=>{o([{name:p,pattern:w},...i().filter(y=>y.name!==p)]),c(0)})},a=()=>{let p=d.value;Zt(()=>{o([...i().filter(w=>w.name!==p)]),c(0)})};let d,g;Y(Oe(()=>e.pattern,p=>{!g||!p||(g.value=p)}));const m=p=>{var w;return((w=t())==null?void 0:w.filter(y=>y.has_tags[p]).length)??0};return(()=>{var p=Zo(),w=p.firstChild,y=w.nextSibling,b=y.firstChild,A=y.nextSibling,E=A.firstChild,x=E.nextSibling,q=x.nextSibling,ie=q.nextSibling;return O(w,K(Be,{get each(){return s()},children:(k,T)=>(()=>{var N=Xo(),j=N.firstChild,de=j.nextSibling,hr=de.nextSibling;return N.$$click=()=>c(T()),O(j,()=>k.name),O(de,()=>k.pattern),O(hr,()=>m(k.name)),ce(()=>Sn(N,"pattern"+(l()===T()?" active":""))),N})()})),O(y,()=>s().length,b),qe(k=>d=k,E),qe(k=>g=k,x),bt(x,"spellcheck",!1),q.$$click=f,ie.$$click=a,p})()},is=e=>{const t=J(()=>"white"),n=(o,s)=>{console.log(o,s)},r=()=>{e.fen&&navigator.clipboard.writeText(e.fen)},i=o=>{let s=[],l=[];if(o.map(c=>{c.dest===void 0?l.push(Fe(c.orig)):s.push([Fe(c.orig),Fe(c.dest)])}),e.fen){let c=Wo.fromSetup(go(e.fen).unwrap()).unwrap(),u=c.board[c.turn].intersect(c.board.king).singleSquare(),a=so(u).map(d=>{if(d===void 0)return"Oo";if(l.includes(d)){let m=c.board.get(d);if(m){let p="f";return`${m.color===c.turn?p.toUpperCase():p}o`}}let g=s.find(m=>m[1]===d);if(g){let m=g[0],p=c.board.get(m);if(p){let w=c.clone();if(w.turn=p.color,w.board.take(u),w.dests(m).has(d))return`${p.color===c.turn?"F":"f"}n`}}return"Xx"}).join("");e.on_pattern(a)}};return(()=>{var o=Yo(),s=o.firstChild,l=s.nextSibling,c=l.nextSibling,u=c.firstChild,f=u.nextSibling,a=f.nextSibling;return O(l,K(wo,{onShapes:i,get fen_uci(){return e.fen?[e.fen,void 0]:void 0},doPromotion:void 0,get color(){return t()},dests:new Map,onMoveAfter:n})),a.$$click=r,ce(()=>u.value=e.fen),o})()};Dr(["input","click"]);const os=document.getElementById("root");Tr(()=>K(Jo,{}),os);
